<html>
<head><title>WAD file structure</title></head>
<body>
<p>Props go out to the many folks out there who have figured out this stuff before I did.  Hopefully I can summarize some of what I consider to be the important points here.
<p>Header - a 12 byte sequence.  <font color="blue">80, 87, 65, 68, 11, 0, 0, 0, 212, 2, 0, 0, 0</font>
<ul>
<li>Bytes 0-3: WAD type - either PWAD or IWAD (characters).  <font color="blue">80, 87, 65, 68</font>
<li>Bytes 4-7: Number of lumps (<a href="#long">long integer</a>). <font color="blue">11, 0, 0, 0</font>
<li>Bytes 8-12: File offset to the beginning of the directory (long integer). <font color="blue">212, 2, 0, 0, 0</font>
</ul>
<p>Directory - a 16 byte sequence for each lump.  <font color="blue">13, 0, 0, 0, 10, 0, 0, 0, 84, 72, 73, 78, 71, 83, 0, 0</font>
<ul>
<li>Bytes 0-3: The file offset to the start of the lump (long integer).  <font color="blue">13, 0, 0, 0</font>
<li>Bytes 4-7: Size of the lump (long integer).  <font color="blue">10, 0, 0, 0</font>
<li>Bytes 8-15: The name of the lump padded with zeros (characters).  <font color="blue">84, 72, 73, 78, 71, 83, 0, 0</font>
</ul>

<hr>
<ul>
<li><a name="#long"/>All long integers in WAD files are 32 bit unsigned longs in little-endian format.  So the byte sequence <font color="blue">212 2 0 0</font> is really <font color="blue">0 0 2 212</font> which translates to <font color="blue">724</font> decimal.  I'm using the following Ruby snippet to do this transformation:
<pre>
y=""
[212,2,0,0].each {|x| y << x.chr }
y.unpack("V")
</pre>
<p>Also, I'm a bit of a dolt, so I had to do this to understand this byte packing order.  <font color="blue">0 0 2 212</font> converted to binary is <code>00000000 00000000 00000010 11001010</code>.  So the <code>1</code> is in the <code>512</code> place, so <code>512 + 212 = 724</code>.
<p>



<li>Some notes from a fella on Slashdot - the WAD file builder only needs to generate the THINGS, LINEDEFS, SIDEDEFS, VERTEXES, AND SECTORS.  Everything else is generated by a <a href="http://doombsp.sf.net/">BSP node builder</a>.
</ul>
</body>
</html>
